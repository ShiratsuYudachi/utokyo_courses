<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>东京大学课程列表</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <style>
        :root {
            --primary-color: #0f2e5c;
            --secondary-color: #43a047;
            --accent-color: #f5a623;
            --text-color: #333;
            --light-bg: #f8f9fa;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-color);
            background-color: #f5f7fa;
            padding-top: 60px;
        }
        
        .navbar {
            background-color: var(--primary-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            color: white !important;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            margin-bottom: 20px;
            border: none;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            padding: 15px 20px;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .badge {
            font-weight: 500;
            padding: 5px 10px;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        .badge-term {
            background-color: var(--secondary-color);
        }
        
        .badge-level {
            background-color: var(--accent-color);
            color: #333;
        }
        
        .badge-schedule {
            background-color: #5c6bc0;
        }
        
        .search-container {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .filter-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .filter-btn:hover {
            background-color: #0d2649;
        }
        
        .course-info {
            margin-bottom: 8px;
        }
        
        .course-info i {
            width: 20px;
            color: var(--primary-color);
            margin-right: 8px;
        }
        
        .pagination {
            margin-top: 30px;
            justify-content: center;
        }
        
        .page-link {
            color: var(--primary-color);
        }
        
        .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }
        
        .spinner-border {
            color: var(--primary-color);
        }
        
        footer {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            margin-top: 50px;
        }
        
        .stats-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .stats-item {
            text-align: center;
            padding: 15px;
        }
        
        .stats-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .stats-label {
            font-size: 1rem;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="bi bi-book me-2"></i>东京大学课程浏览器
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#"><i class="bi bi-house-door me-1"></i>首页</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#stats"><i class="bi bi-bar-chart me-1"></i>统计</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#courses"><i class="bi bi-journal-text me-1"></i>课程</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <div class="container">
        <!-- 欢迎信息 -->
        <div class="row mb-4 mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body text-center">
                        <h1 class="display-4">欢迎使用东京大学课程浏览器</h1>
                        <p class="lead">感谢Claude 3.7 Sonnet</p>
                        <p class="lead">消灭人类暴政，世界属于AI</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 统计信息 -->
        <section id="stats" class="mb-5">
            <h2 class="mb-4"><i class="bi bi-bar-chart me-2"></i>课程统计</h2>
            <div class="stats-container">
                <div class="row">
                    <div class="col-md-4 stats-item">
                        <div class="stats-number" id="total-courses">0</div>
                        <div class="stats-label">总课程数</div>
                    </div>
                    <div class="col-md-4 stats-item">
                        <div class="stats-number" id="unique-courses">0</div>
                        <div class="stats-label">独特课程数</div>
                    </div>
                    <div class="col-md-4 stats-item">
                        <div class="stats-number" id="departments-count">0</div>
                        <div class="stats-label">院系数量</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 搜索和过滤 -->
        <section id="search" class="mb-5">
            <h2 class="mb-4"><i class="bi bi-search me-2"></i>搜索课程</h2>
            <div class="search-container">
                <div class="row g-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="search-input" placeholder="搜索课程名称、教师或代码...">
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="term-filter">
                            <option value="">所有学期</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="level-filter">
                            <option value="">所有级别</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="page-size-selector">
                            <option value="10">每页 10 条</option>
                            <option value="20">每页 20 条</option>
                            <option value="50">每页 50 条</option>
                            <option value="100">每页 100 条</option>
                            <option value="1000">每页 1000 条</option>
                            <option value="-1">显示全部</option>
                        </select>
                    </div>
                    <div class="col-md-6">
                        <select class="form-select" id="department-filter">
                            <option value="">所有院系</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button class="btn filter-btn w-100" id="filter-btn">
                            <i class="bi bi-funnel me-2"></i>应用过滤器
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- 课程列表 -->
        <section id="courses">
            <h2 class="mb-4"><i class="bi bi-journal-text me-2"></i>课程列表</h2>
            
            <!-- 加载动画 -->
            <div id="loading" class="loading">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">加载中...</span>
                </div>
            </div>
            
            <!-- 课程卡片容器 -->
            <div class="row" id="courses-container">
                <!-- 课程卡片将通过JavaScript动态添加 -->
            </div>
            
            <!-- 分页 -->
            <nav aria-label="Page navigation">
                <ul class="pagination" id="pagination">
                    <!-- 分页按钮将通过JavaScript动态添加 -->
                </ul>
            </nav>
        </section>
    </div>

    <!-- 页脚 -->
    <footer class="text-center">
        <div class="container">
            <p>© 2024 东京大学课程浏览器 | 数据来源于东京大学官方网站</p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 全局变量
        let allCourses = [];
        let uniqueCourses = [];
        let filteredCourses = [];
        let currentPage = 1;
        let coursesPerPage = 10;
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                // 加载课程数据
                await loadCourseData();
                
                // 初始化过滤器
                initializeFilters();
                
                // 显示第一页课程
                displayCourses(1);
                
                // 设置事件监听器
                document.getElementById('filter-btn').addEventListener('click', function() {
                    applyFilters();
                });
                
                document.getElementById('search-input').addEventListener('keyup', function(event) {
                    if (event.key === 'Enter') {
                        applyFilters();
                    }
                });
                
                // 添加每页显示数量选择器的事件监听器
                document.getElementById('page-size-selector').addEventListener('change', function() {
                    const newPageSize = parseInt(this.value);
                    if (newPageSize !== coursesPerPage) {
                        coursesPerPage = newPageSize;
                        currentPage = 1; // 重置到第一页
                        displayCourses(1);
                    }
                });
            } catch (error) {
                console.error('加载数据时出错:', error);
                document.getElementById('loading').innerHTML = `
                    <div class="alert alert-danger" role="alert">
                        加载数据时出错: ${error.message}
                    </div>
                `;
            }
        });
        
        // 加载课程数据
        async function loadCourseData() {
            try {
                // 加载所有课程
                const allCoursesResponse = await fetch('all_courses.json');
                allCourses = await allCoursesResponse.json();
                
                // 加载去重后的课程
                const uniqueCoursesResponse = await fetch('unique_courses.json');
                uniqueCourses = await uniqueCoursesResponse.json();
                
                // 初始显示去重后的课程
                filteredCourses = [...uniqueCourses];
                
                // 更新统计信息
                document.getElementById('total-courses').textContent = allCourses.length;
                document.getElementById('unique-courses').textContent = uniqueCourses.length;
                
                // 计算院系数量
                const departments = new Set();
                uniqueCourses.forEach(course => {
                    if (course.department) {
                        departments.add(course.department);
                    }
                });
                document.getElementById('departments-count').textContent = departments.size;
                
                // 隐藏加载动画
                document.getElementById('loading').style.display = 'none';
            } catch (error) {
                throw new Error(`无法加载课程数据: ${error.message}`);
            }
        }
        
        // 初始化过滤器
        function initializeFilters() {
            // 学期过滤器
            const termFilter = document.getElementById('term-filter');
            const terms = new Set();
            uniqueCourses.forEach(course => {
                if (course.term) {
                    terms.add(course.term);
                }
            });
            
            terms.forEach(term => {
                const option = document.createElement('option');
                option.value = term;
                option.textContent = term;
                termFilter.appendChild(option);
            });
            
            // 级别过滤器
            const levelFilter = document.getElementById('level-filter');
            const levels = new Set();
            uniqueCourses.forEach(course => {
                if (course.level) {
                    levels.add(course.level);
                }
            });
            
            levels.forEach(level => {
                const option = document.createElement('option');
                option.value = level;
                option.textContent = level;
                levelFilter.appendChild(option);
            });
            
            // 院系过滤器
            const departmentFilter = document.getElementById('department-filter');
            const departments = new Set();
            uniqueCourses.forEach(course => {
                if (course.department) {
                    departments.add(course.department);
                }
            });
            
            departments.forEach(department => {
                const option = document.createElement('option');
                option.value = department;
                option.textContent = department;
                departmentFilter.appendChild(option);
            });
        }
        
        // 应用过滤器
        function applyFilters() {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const termFilter = document.getElementById('term-filter').value;
            const levelFilter = document.getElementById('level-filter').value;
            const departmentFilter = document.getElementById('department-filter').value;
            
            filteredCourses = uniqueCourses.filter(course => {
                // 搜索词过滤
                const matchesSearch = !searchTerm || 
                    (course.courseName && course.courseName.toLowerCase().includes(searchTerm)) ||
                    (course.instructor && course.instructor.toLowerCase().includes(searchTerm)) ||
                    (course.courseCode && course.courseCode.toLowerCase().includes(searchTerm));
                
                // 学期过滤
                const matchesTerm = !termFilter || course.term === termFilter;
                
                // 级别过滤
                const matchesLevel = !levelFilter || course.level === levelFilter;
                
                // 院系过滤
                const matchesDepartment = !departmentFilter || course.department === departmentFilter;
                
                return matchesSearch && matchesTerm && matchesLevel && matchesDepartment;
            });
            
            // 重置到第一页并显示结果
            currentPage = 1;
            displayCourses(currentPage);
        }
        
        // 显示课程
        function displayCourses(page) {
            const coursesContainer = document.getElementById('courses-container');
            coursesContainer.innerHTML = '';
            
            // 计算当前页的课程
            let currentCourses;
            
            if (coursesPerPage === -1) {
                // 显示全部课程
                currentCourses = filteredCourses;
            } else {
                // 分页显示
                const startIndex = (page - 1) * coursesPerPage;
                const endIndex = Math.min(startIndex + coursesPerPage, filteredCourses.length);
                currentCourses = filteredCourses.slice(startIndex, endIndex);
            }
            
            if (currentCourses.length === 0) {
                coursesContainer.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-info" role="alert">
                            没有找到匹配的课程。请尝试不同的搜索条件。
                        </div>
                    </div>
                `;
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            
            // 创建课程卡片
            currentCourses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.className = 'col-md-6 col-lg-6';
                courseCard.innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">${course.courseName || '未知课程'}</h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                ${course.term ? `<span class="badge badge-term">${course.term}</span>` : ''}
                                ${course.level ? `<span class="badge badge-level">${course.level}</span>` : ''}
                                ${course.schedule ? `<span class="badge badge-schedule">${course.schedule}</span>` : ''}
                            </div>
                            
                            <div class="course-info">
                                <i class="bi bi-person-badge"></i>
                                <strong>教师:</strong> ${course.instructor || '未指定'}
                            </div>
                            
                            <div class="course-info">
                                <i class="bi bi-code-square"></i>
                                <strong>课程代码:</strong> ${course.courseCode || '未指定'}
                            </div>
                            
                            <div class="course-info">
                                <i class="bi bi-building"></i>
                                <strong>院系:</strong> ${course.department || '未指定'}
                            </div>
                            
                            <div class="course-info">
                                <i class="bi bi-mortarboard"></i>
                                <strong>专业:</strong> ${course.major || '未指定'}
                            </div>
                            
                            <div class="course-info">
                                <i class="bi bi-geo-alt"></i>
                                <strong>地点:</strong> ${course.location || '未指定'}
                            </div>
                        </div>
                    </div>
                `;
                coursesContainer.appendChild(courseCard);
            });
            
            // 更新分页
            updatePagination(page);
        }
        
        // 更新分页
        function updatePagination(currentPage) {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';
            
            // 如果显示全部，不显示分页
            if (coursesPerPage === -1) {
                pagination.innerHTML = `
                    <div class="text-center mt-3">
                        <span class="text-muted">显示全部 ${filteredCourses.length} 条结果</span>
                    </div>
                `;
                return;
            }
            
            const totalPages = Math.ceil(filteredCourses.length / coursesPerPage);
            
            // 如果只有一页，不显示分页
            if (totalPages <= 1) {
                return;
            }
            
            // 上一页按钮
            const prevItem = document.createElement('li');
            prevItem.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevItem.innerHTML = `
                <a class="page-link" href="#" aria-label="Previous" ${currentPage > 1 ? `onclick="displayCourses(${currentPage - 1}); return false;"` : ''}>
                    <span aria-hidden="true">&laquo;</span>
                </a>
            `;
            pagination.appendChild(prevItem);
            
            // 页码按钮
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageItem = document.createElement('li');
                pageItem.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageItem.innerHTML = `
                    <a class="page-link" href="#" onclick="displayCourses(${i}); return false;">${i}</a>
                `;
                pagination.appendChild(pageItem);
            }
            
            // 下一页按钮
            const nextItem = document.createElement('li');
            nextItem.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextItem.innerHTML = `
                <a class="page-link" href="#" aria-label="Next" ${currentPage < totalPages ? `onclick="displayCourses(${currentPage + 1}); return false;"` : ''}>
                    <span aria-hidden="true">&raquo;</span>
                </a>
            `;
            pagination.appendChild(nextItem);
        }
    </script>
</body>
</html> 